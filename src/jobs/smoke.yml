description: >
  Run smoke tests on the frontend app.

executor: e2e
environment:
  TEST_SUBTYPE: ':smoke-test:'
parameters:
  project:
    default: ""
    description: Lagoon project name
    type: string
  be_url:
    default: ""
    description: The backend URL for testing
    type: string
  fe_url:
    default: ""
    description: The frontend URL for testing
    type: string
  browser:
    type: string
    description: Browser, default to headless Chrome. If it's set to any other browser, BrowserStack user key will be required.
    default: "chrome_headless"
steps:
  - run:
      name: "Setup test environment configuration"
      command: |
        case ${CIRCLE_BRANCH} in
          standby|production|prod-left|prod-right)
            echo 'export SMOKE_TAG="@smoke-prod"' >> $BASH_ENV;;
          *)
            echo 'export SMOKE_TAG="@smoke"' >> $BASH_ENV;;
        esac
  - folder1/run_e2e:
      tags: "(${SMOKE_TAG} and @core) or (${SMOKE_TAG} and @<< parameters.project >>)"
      project: << parameters.project >>
      be_url: << parameters.be_url >>
      fe_url: << parameters.fe_url >>
      fe_only: true
      browser: << parameters.browser >>
      retry: 0
  - notify_slack
